<!DOCTYPE html><html><head><title>Blade32232.github.io</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/blade32232web/docs/assets/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/blade32232web/docs/assets/codedoc-bundle.js"></script></head><body><div class="header-0-0-4"><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><a class="github-button" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="false" data-show-count="true" data-size="false" href="https://github.com/blade32232/blade32232web/">Star</a><br><br></div><div id="-codedoc-container" class="container"><marker><style>
img[src*="#centered"] {
    margin:auto;
    display:block;
 }
  div
 {
   text-align: justify;
   text-justify: inter-word;
 }
 img[src*="#invertedcenter"] {
    margin:auto;
    display:block;
    background: white;
    width: 75%;
    height: auto;
 }
 img[src*="#small"] {
    width: 250px;
    height: auto;
 }
 div.centertext{
    text-align:center;
 }
 abbr{
    border: none;
    text-decoration: none;
    color: lightblue;
}
h1{
   text-align:center;
}
</style>

</marker><h1 id="system-overview" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>System Overview</h1><marker><hr>

</marker><h2 id="system-concept" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>System Concept</h2><p>The Tethered Flight Arena makes use of DeepLabCut-live to perform markerless pose estimation in order to capture the movements of a tethered animal (currently wing beat amplitude, head yaw and roll, and longitudinal axis). This information is sent via a socket into another program known as Unity. Here, calculations are performed on the data by the CAVE software, which is then used to manipulate the tethered animal’s avatar within the scene. These changes or updates to the avatar’s position within the scene are presented as a stimulus to the tethered animal via 3 screens forming what is known as a closed loop.</p><p>Successfully closing the loop in such a way will allow for an increased understanding of the tethered animal’s behaviour and decision making as well as their ability to visually detect and target objects within the virtual environment, such as flora, predators and prey.</p><h2 id="physical-setup" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Physical Setup</h2><p>The Tethered Flight Arena shown below in Figure 1, requires a variety of hardware in order to function properly, it is also likely that the physical setup will need to vary based on which species of animal is being studied. As such, this section is based on the requirements for studying the behaviour of an Eristalis Tenax hoverfly as an example. </p><p><img src="../../images/Systemdesignimages/image12.jpg#centered" alt="Camera"></p><marker><div class="centertext"><sup><i>Figure 1: An image of the Tethered Flight Arena.</i></sup></div>

</marker><p><strong>Specifications:</strong></p><p>1 - 3x Asus Rog Swift PG279QE monitors connected to the computer via display cable. The three screens are rotated into the portrait position and are placed an equal distance from the tethered animal. The monitors are used to fill as much of the tethered animal’s visual field as possible, collectively the monitors are referred to as the stimulus screens.</p><p>2 - Tethered animal (Eristalis Tenax)</p><p>3 - An infrared light filter (760-860nm, 95%) attached to the camera (see below) which only allows infrared light through.</p><p>4 -  A PlayStation 3 Eye Motion Camera used to capture live footage of the tethered animal. This camera has been modified to detect infrared light, which is done by removing the filter layer on the camera sensor. The camera is set to capture at 100 Hz at a spatial resolution of 320x240. 100 Hz allows motion blur of the wings, which is optimal for detecting the WBA.</p><p>5 - A Custom built PC which includes a Nvidia RTX 3080 (10GB VRAM), 1TB of NVMe storage and an intel i7-10700k along with 32GB of RAM. This is used to provide the computational power necessary to run both DLC-live and Unity at the same time.</p><p>6 - DLC-live (pose estimation software), takes a video feed as input. Pose estimation is performed on each frame and the coordinates of the labels are then packaged and sent to Unity. With the described hardware Unity receives approximately 135 packets a second, 100 of these contain unique values, while the rest are all duplicates (camera records at 100 Hz).</p><p>7 - Unity development platform (CAVE project), takes the tracked points (labels) as input and uses them to move the tethered animal’s avatar within the virtual environment. This is displayed on the three stimulus screens surrounding the tethered animal. The screens are updated at 165 Hz. The CAVE software also provides the user with an interface accessible on the experimenter’s monitor.</p><p>8 - A generic monitor used to display a basic user interface to the experimenter.</p><p>9 - 2x USB Reading Lamps modified to use Infrared LEDs, they are used to illuminate the tethered animal from an angle of the experimenter’s choice. </p><p>10 - Infrared microscope ring light used to illuminate the tethered animal from directly above. </p><p>11 - An infrared absorbing material used to provide a black background during video capture, this produces clearer images for DLC-live to analyse.</p><p>Diagrams of the system are provided in Figures 2 and 3. Figure 2 highlights the flow of information from the camera all the way through to the stimulus screens, it also shows the number of times per second unique information is passed from one component to the next as well as the latency added by each section of the system. Figure 3 is an isometric representation of all the equipment and its position within the arena.</p><p>Within the system, the camera captures unique frames at 100 Hz and passes these frames into DLC-live (red, figure 2). DLC-live performs pose estimation more than 100 times a second but only 100 unique packets are sent into Unity (green, figure 2). From here Unity updates the tethered animal’s avatar’s  position and shows a new point of view to the tethered animal at 165 Hz (blue, figure 2). However, despite the perspective being unique, 65 of these frames are generated using DLC-live data that is not unique. </p><p>It is also necessary to create a custom rig to hold the tethered animal, camera and infrared lights in position.</p><p><img src="../../images/Systemdesignimages/image10.png#invertedcenter" alt="Camera"></p><marker><div class="centertext"><sup><i>Figure 2: (A) A system blueprint of the Tethered Flight Arena, highlighting each component and the flow of information. Where the frequency of unique information is represented in Hz and the system latency is represented in ms, the system has a minimum latency of 48ms and a maximum latency of 74ms. (B) A side view illustrating the tethered animal’s position relative to several components of the rig. (C) The raw image captured by the camera. (D) The same image as shown in part C after DLC-live has performed pose estimation and placed labels, the x and y coordinates of these labels are then sent to Unity where the behaviour of the tethered animal is simulated. (E) A frame from the current environment being rendered by Unity in real time as seen from a single display (120 degrees of the horizontal visual field).</i></sup></div>

</marker><p><img src="../../images/Systemdesignimages/image9.png#invertedcenter" alt="Camera"></p><marker><div class="centertext"><sup><i>Figure 3: An isometric view of the Tethered Flight Arena, highlighting the positioning of all relevant equipment and materials.</i></sup></div>

</marker><h2 id="system-latency" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>System Latency</h2><p>The system latency describes the amount of time that passes before the tethered animal’s physical movements are used to generate a new perspective within the virtual environment which is shown to the tethered animal via the stimulus screens.</p><p>This latency was calculated through two separate approaches, estimated latency and measured latency. Estimated latency was calculated by outputting timestamps when certain functions were executed within the software of both DLC-live and Unity, Measured latency was calculated using a photodiode to measure the duration of time that passed before a real world change was represented on the stimulus screens.</p><p>The outcome of these two separate measurements was an estimated latency of xx ms and a measured latency of xx ms. The correlation is …</p><p>The main contributing factors to system latency are</p><ul><li>Camera exposure settings (0 - 10 ms)</li><li>Camera frame buffer (10-20?)</li><li>Pose estimation by DLC-live (16-26 ms)</li><li>Unity receive packet and load values (&lt;100 microseconds)</li><li>Unity frame buffer (6-12?)</li><li>Frame generated from updated values (0 - 6 ms)</li></ul><p>Average latency (standard deviation or error of the mean)
Best case latency
Worst case latency</p><h2 id="target-audience" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Target Audience</h2><p>The target audience for this product are the current and future researchers who are aiming to understand the behaviour of tetherable animals which respond to visual stimuli (screens) and whose physical movements can be tracked using DLC-live. Through this system researchers will be able to show various types of stimuli in a 3D environment and record the tethered animal’s physical responses during closed loop experimentation. This is especially appealing in virtual environments as it will give the researchers complete control over the scene and the objects in it. </p><p>While this product is not necessarily targeted at the tethered animals themselves, steps must be taken to ensure that the experience they have is as close to life-like as possible. This should result in less error and fewer results which do not match the real world behaviour for such animals. </p><h2 id="genres" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Genre(s)</h2><p>Tethered Flight, Exploration, Research</p><h2 id="system-flow-summary" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>System Flow Summary</h2><p>When using the CAVE project, the experimenter will start a sequence by opening the MainMenu scene. From here they can select the sequence manager in the hierarchy and add the sequences they wish to run. Now the user can press the Unity “Play” button in order to start the runtime and give the user at the menu shown below in Figure 4.</p><p><img src="../../images/Systemdesignimages/cave.png#invertedcenter" alt="Camera"></p><marker><div class="centertext"><sup><i>Figure 4: Main menu of the CAVE software, only active once the MainMenu scene is run.</i></sup></div>

</marker><p>From the CAVE user interface the experimenter can start a new sequence or replay a previous trial. If starting a new sequence the experimenter can also provide the sex of the tethered animal (‘N/A’, figure 4) as well as a unique number (‘Animal Number’, figure 4). This information is used to alter settings based on the current animal’s sex and help identify the saved data for this specific animal. </p><p>After a sequence is complete the system will play the default stimulus as chosen by the experimenter. This stimulus will continue to play until the user clicks the start sequence button (‘Start Sequence’, figure 4). Upon finishing the last sequence the runtime will automatically end. To start it again the user needs to press the unity “Play” button. </p><p>In order to create and edit system settings (Gain, Framerate, Save filepath), sequences, and trials the user must make use of the scriptable objects present in the Unity project. The CAVE user manual discusses how to use these scriptable objects in detail.</p><h2 id="look-and-feel" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Look and Feel</h2><p>The CAVE software will prioritise temporal performance (run on 3 monitors at 165 Hz) over spatial resolution (what would look like more realistic visuals to the human observer). By using objects with simplified geometry (low polygon count) as shown in Figure 5, the experimenter can present what they want the tethered animal to see in satisfactory detail while still allowing for the best possible temporal performance.</p><p>As the animal being used as a template by this system (Eristalis tenax) has fast photoreceptors, a high refresh rate of the stimulus screens (165 Hz) is necessary to provide an appropriate stimulus. Other animals may not require such a fast refresh rate allowing for more detailed scenes as well as less intensive hardware.</p><p><img src="../../images/Systemdesignimages/image8.png#centered" alt="Camera"></p><marker><div class="centertext"><sup><i>Figure 5: An image from the tethered animal’s perspective (centre screen only).</i></sup></div>

</marker><script id="gJkFlYxNDp">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("gJkFlYxNDp", "y/Z0TkGUuy90rdYV0cdhQg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="contentnav-0-0-9" data-no-search=""><a href="#system-overview" class="h1" data-content-highlight="system-overview">System Overview</a><a href="#system-concept" class="h2" data-content-highlight="system-concept">System Concept</a><a href="#physical-setup" class="h2" data-content-highlight="physical-setup">Physical Setup</a><a href="#system-latency" class="h2" data-content-highlight="system-latency">System Latency</a><a href="#target-audience" class="h2" data-content-highlight="target-audience">Target Audience</a><a href="#genres" class="h2" data-content-highlight="genres">Genre(s)</a><a href="#system-flow-summary" class="h2" data-content-highlight="system-flow-summary">System Flow Summary</a><a href="#look-and-feel" class="h2" data-content-highlight="look-and-feel">Look and Feel</a></div></div><div id="-codedoc-toc" class="toc-0-0-6"><div class="content-0-0-7"><p><a href="/blade32232web/">Home</a></p><div class="collapse-0-0-3 "><script id="kehUmKyQTI">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("kehUmKyQTI", "/kqcZjlRRzc1ickjP7DYCg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">CAVE - User Manual</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/blade32232web/docs/usermanual/settings">Settings</a>
<a href="/blade32232web/docs/usermanual/workflow">Workflow</a>
<a href="/blade32232web/docs/usermanual/datacollection">Data Colletion</a>
<a href="/blade32232web/docs/usermanual/scriptableobjects">Scriptable Objects</a>
<a href="/blade32232web/docs/usermanual/ooimanagement">OOI Managgement</a>
<a href="/blade32232web/docs/usermanual/unityproject">Unity Project</a></p></div></div><div class="collapse-0-0-3 "><script id="vNLcWYiCWs">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("vNLcWYiCWs", "/kqcZjlRRzc1ickjP7DYCg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">CAVE - System Design</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/blade32232web/docs/systemdesign/terminology">Terminology</a>
<a href="/blade32232web/docs/systemdesign/systemoverview">System Overview</a>
<a href="/blade32232web/docs/systemdesign/userexperience">User Experience</a>
<a href="/blade32232web/docs/systemdesign/mechanics">Mechanics</a>
<a href="/blade32232web/docs/systemdesign/stimuli">Stimuli</a>
<a href="/blade32232web/docs/systemdesign/interface">Interface</a>
<a href="/blade32232web/docs/systemdesign/extrainformation">Extra Information</a></p></div></div><div class="collapse-0-0-3 "><script id="DibPWpcdHN">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("DibPWpcdHN", "/kqcZjlRRzc1ickjP7DYCg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">TFA - Flyfly</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/blade32232web/docs/flyfly/installation">Installation</a>
<a href="/blade32232web/docs/flyfly/windowmenus">Window Menus</a>
<a href="/blade32232web/docs/flyfly/stimuli">Stimuli</a></p></div></div><div class="collapse-0-0-3 "><script id="jvbJdDvExc">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("jvbJdDvExc", "/kqcZjlRRzc1ickjP7DYCg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">Hoverfly Motion Vision Lab</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/blade32232web/docs/About">About Us</a>
<a href="/blade32232web/docs/Papers">Papers</a>
<a href="/blade32232web/docs/Videos">Videos</a></p></div></div></div><div class="search-0-0-8"><script id="NKuyYzXIQI">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("NKuyYzXIQI", "HvP1vwP888Sdhuopqchp7w==", {"repo":"blade32232web","user":"blade32232","root":"docs/md","pick":"\\.md$","drop":"(^_)|(\\/_)"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><div class="footer-0-0-5"><div class="left"><script id="wVVxwkqVNW">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("wVVxwkqVNW", "Vd2viD9554hXlsqM3Ax/yw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"><a href="https://github.com/blade32232/blade32232web/" target="_blank">GitHub</a></div></div><div class="right"><script id="aQTGHYHESy">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("aQTGHYHESy", "E6CVdlySM0U/C7SmdHnYLw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="fpM_K_GnGY">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("fpM_K_GnGY", "nRVcrIhyv2PbPb5UKimI3Q==", {"namespace":"/blade32232web"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>